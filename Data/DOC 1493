Title : Module:Hatnote/doc
Text : {{high-risk|1,000,000+}}
{{used in system|in [[MediaWiki:Wantedpages-summary]]}}
{{module rating|protected}}

This is a meta-module that provides various functions for making [[Wikipedia:Hatnote|hatnotes]]. It implements the {{tl|hatnote}} template, for use in hatnotes at the top of pages, and the {{tl|format link}} template, which is used to format a wikilink for use in hatnotes. It also contains a number of helper functions for use in other Lua hatnote modules.

== Use from wikitext ==

The functions in this module cannot be used directly from #invoke, and must be used through templates instead. Please see [[Template:Hatnote]] and [[Template:Format link]] for documentation.

== Use from other Lua modules ==

To load this module from another Lua module, use the following code.

<source lang="lua">
local mHatnote = require('Module:Hatnote')
</source>

You can then use the functions as documented below.

=== Hatnote ===

<source lang="lua">
mHatnote._hatnote(s, options)
</source>

Formats the string <var>s</var> as a hatnote. This encloses <var>s</var> in the tags {{tag|div|params=class="hatnote"}}. Options are provided in the <var>options</var> table. Options include:
* <var>options.extraclasses</var> - a string of extra classes to provide
* <var>options.selfref</var> - if this is not nil or false, adds the class "selfref", used to denote self-references to Wikipedia (see [[Template:Selfref]]))
The CSS of the hatnote class is defined in [[MediaWiki:Common.css]].

; Example 1

<source lang="lua">
mHatnote._hatnote('This is a hatnote.')
</source>

Produces:
{{tag|div|content=This is a hatnote.|params=class="hatnote"}}

Displays as:
{{hatnote|This is a hatnote.}}

; Example 2

<source lang="lua">
mHatnote._hatnote('This is a hatnote.', {extraclasses = 'boilerplate seealso', selfref = true})
</source>

Produces:
{{tag|div|content=This is a hatnote.|params=class="hatnote boilerplate seealso selfref"}}

Displayed as:
{{hatnote|This is a hatnote.|extraclasses=boilerplate seealso|selfref=true}}

=== Format link ===

<source lang="lua">
mHatnote._formatLink(link, display)
</source>

Formats <var>link</var> as a wikilink for display in hatnote templates, with optional display value <var>display</var>. Categories and files are automatically escaped with the [[Help:Colon trick|colon trick]], and links to sections are automatically formatted as ''page ยง section'', rather than the MediaWiki default of ''page#section''.

;Examples:
: {{code|mHatnote._formatLink('Lion')|lua}} &rarr; <nowiki>[[Lion]]</nowiki> &rarr; {{format hatnote link|Lion}}
: {{code|mHatnote._formatLink('Lion#Etymology')|lua}} &rarr; <nowiki>[[Lion#Etymology|Lion ยง Etymology]]</nowiki> &rarr; {{format hatnote link|Lion#Etymology}}
: {{code|mHatnote._formatLink('Category:Lions')|lua}} &rarr; <nowiki>[[:Category:Lions]]</nowiki> &rarr; {{format hatnote link|Category:Lions}}
: {{code|mHatnote._formatLink('Lion#Etymology', 'Etymology of lion')|lua}} &rarr; <nowiki>[[Lion#Etymology|Etymology of lion]]</nowiki> &rarr; {{format hatnote link|Lion#Etymology|Etymology of lion}}

=== Format pages ===

<source lang="lua">
mHatnote.formatPages(...)
</source>

Formats a list of pages using the [[#Format link|_formatLink]] function, and returns the result as an array. For example, the code {{code|mHatnote.formatPages('Lion', 'Category:Lions', 'Lion#Etymology')|lua}} would produce an array like {{code|{'[[Lion]]', '[[:Category:Lions]]', '[[Lion#Etymology|Lion ยง Etymology]]'}|lua}}.

=== Format page tables ===

<source lang="lua">
mHatnote.formatPageTables(...)
</source>

Takes a list of page/display tables, formats them with the [[#Format link|_formatLink]] function, and returns the result as an array. Each item in the list must be a table. The first value in the table is the link, and is required. The second value in the table is the display value, and is optional. For example, the code {{code|mHatnote.formatPages({'Lion', 'the Lion article'}, {'Category:Lions'}, {'Lion#Etymology', 'the etymology of lion'})|lua}} would produce an array like {{code|{'[[Lion|the Lion article]]', '[[:Category:Lions]]', '[[Lion#Etymology|the etymology of lion]]'}|lua}}.

=== Find namespace id ===

<source lang="lua">
mHatnote.findNamespaceId(link, removeColon)
</source>

Finds the [[WP:NS|namespace id]] of the string <var>link</var>, which should be a valid page name, with or without the section name. This function will not work if the page name is enclosed with square brackets. When trying to parse the namespace name, colons are removed from the start of the link by default. This is helpful if users have specified colons when they are not strictly necessary. If you do not need to check for initial colons, set <var>removeColon</var> to false.

;Examples:
: {{code|mHatnote.findNamespaceId('Lion')|lua}} &rarr; 0
: {{code|mHatnote.findNamespaceId('Category:Lions')|lua}} &rarr; 14
: {{code|mHatnote.findNamespaceId(':Category:Lions')|lua}} &rarr; 14
: {{code|mHatnote.findNamespaceId(':Category:Lions', false)|lua}} &rarr; 0 (the namespace is detected as ":Category", rather than "Category")

=== Make wikitext error ===

<source lang="lua">
mHatnote.makeWikitextError(msg, helpLink, addTrackingCategory)
</source>

Formats the string <var>msg</var> as a red wikitext error message, with optional link to a help page <var>helpLink</var>. Normally this function also adds {{clc|Hatnote templates with errors}}; however, if <var>addTrackingCategory</var> is not false after being passed through [[Module:Yesno]], then the category is suppressed. This means that the category can be suppressed with <var>addTrackingCategory</var> values including "no", "n", 0, "false", and {{code|false|lua}}.

Examples:
:{{code|mHatnote.makeWikitextError('an error has occurred')|lua}} &rarr; <strong class="error">Error: an error has occurred.</strong>
:{{code|mHatnote.makeWikitextError('an error has occurred', 'Template:Example#Errors')|lua}} &rarr; <strong class="error">Error: an error has occurred ([[Template:Example#Errors|help]]).</strong>

== Examples ==

For examples of how this module is used in other Lua modules, see the following (listed in order of complexity):

* [[Module:Details]]
* [[Module:Further]]
* [[Module:See also]]
* [[Module:Main]]

<includeonly>{{Sandbox other||
<!-- Categories go here and interwikis go in Wikidata. -->
[[Category:Hatnote modules| ]]
[[Category:Modules that add a tracking category]]

}}</includeonly>
